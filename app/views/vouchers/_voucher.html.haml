- # Partial for creating voucher rows. Should be inside a form
- javascript %w(jquery/jquery.form.js jquery/jquery.ui.custom.min.js)
- javascript %w(voucher.js)

- #Hidden attributes
= f.input :serie_id, :as=>:hidden
= f.input :activity_year_id, :as=>:hidden

%h4 LÃ¤gg till rad
= f.fields_for :add_row do |r|
  %p.input
    = r.label "Konto", :required => false
    = r.text_field :account, :size=>5
  %p.input
    = r.label "Arrangemang", :required => false
    = r.select :arrangement, options_from_collection_for_select(@voucher.organ.arrangements,:id, :to_s), {}, :disabled=>true
  %p.input.money
    = r.label "Summa (kr)", :required => false
    = r.text_field :sum, :size => 20
    %p#spinner.input{:style=>"display: none"}
      = image_tag 'ajax-loader.gif', :class=>:spinner
  .clear
  %p#voucher_info
  
  %hr
  %table#voucher_rows
    %thead
      %tr
        %th.account_number Konto
        %th.account_name Kontonamn
        %th.arrangement Arrangemang
        %th.debet Debet
        %th.kredit Kredit
        %th.actions 
    %tbody
    %tfoot
      %tr
        %td{:colspan=>3}
        %td Diff:
        %td#diff 0 kr
        %td

%hr
= f.submit
      
- ActiveRecord::Base.include_root_in_json = false
/ Below is data for javascript
:javascript
  var voucher_id = #{@voucher.id ? @voucher.id : -1}
  var total_sum = 0 //Total sum of voucher
  var accounts = #{Account.order("number").select([:number,:name,:account_type]).to_json }
  var voucher_row_url = "#{rows_vouchers_path}"
  var arrs = #{Organ.all.reduce(Hash.new) {|h,o| h[o.id] = o.arrangements.select([:id,:number,:name]) ; h }.to_json}
  var num_rows = #{@voucher.voucher_rows.count}
